---
title: "PCA plot of sequencing runs"
author: "Graeme Grimes"
date: `r format(Sys.time(), "%d %B, %Y")`
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(SummarizedExperiment)
library(PCAtools)
library(scatterD3)
```


```{r cars}
se_files<-grep(pattern="archive",invert=T,dir("/scratch/u034/shared/wp5-rna-seq/analysis/rnaseq/",pattern = "salmon_merged_gene_counts.rds",recursive = T),value=T)

run_names<- dirname(dirname(se_files))
names(se_files)=run_names

se_lst<-se_files %>% map(~readRDS(paste0("/scratch/u034/shared/wp5-rna-seq/analysis/rnaseq/",.x)))
se<-purrr::invoke(SummarizedExperiment::cbind,se_lst)

#clean sample id
colData(se)$rnaseq_sample_id=gsub(colnames(se),pattern = "^X",replacement = "")
colData(se)$rnaseq_sample_id=gsub(colData(se)$rnaseq_sample_id,pattern="\\.",replacement = "-")
colData(se)$nfcore_run=rep(names(se_files),sapply(se_lst,ncol))
```

## PCA plot


```{r pressure, echo=FALSE}
 p<-pca(log2(assays(se)$abundance+1),removeVar=0.1)
scatterD3(p$rotated$PC1,
          p$rotated$PC2,
          col_var = coldata(se)$nfcore_run,
          tooltip_text=colnames(se))
```


